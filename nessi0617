-- [[ NESSI HUB FULL POWER : PART 1 ]]
local LP = game:GetService("Players").LocalPlayer
local UIS = game:GetService("UserInputService")
local RS = game:GetService("RunService")

-- 既存UIの徹底削除
if LP.PlayerGui:FindFirstChild("NessiFullPower") then LP.PlayerGui.NessiFullPower:Destroy() end

-- グローバル設定（絶対にバグらせないための _G 固定）
_G.NessiConfig = {
    MapAttack = false, InstantKill = false, FastAttack = false,
    GhostShipFarm = false, SBFarm = false, AutoRaid = false,
    Hitbox = false, HitboxSize = 35, AirWalk = false, SpeedHack = false,
    StickActive = false, TargetPlayer = nil
}
_G.LastRefresh = 0

-- UIメインフレーム
local sg = Instance.new("ScreenGui", LP.PlayerGui); sg.Name = "NessiFullPower"; sg.ResetOnSpawn = false
local main = Instance.new("Frame", sg); main.Size = UDim2.new(0, 300, 0, 520); main.Position = UDim2.new(0.1, 0, 0.2, 0); main.BackgroundColor3 = Color3.fromRGB(15, 15, 20); main.Active = true; main.Draggable = true
Instance.new("UICorner", main).CornerRadius = UDim.new(0, 10)

-- スクロールエリア（機能トグル用）
local scroll = Instance.new("ScrollingFrame", main); scroll.Size = UDim2.new(1, -10, 1, -220); scroll.Position = UDim2.new(0, 5, 0, 45); scroll.BackgroundTransparency = 1; scroll.CanvasSize = UDim2.new(0, 0, 2.5, 0); scroll.ScrollBarThickness = 3
local layout = Instance.new("UIListLayout", scroll); layout.Padding = UDim.new(0, 5); layout.HorizontalAlignment = Enum.HorizontalAlignment.Center

-- プレイヤーリスト専用エリア（UIの下部に固定）
local pTitle = Instance.new("TextLabel", main); pTitle.Size = UDim2.new(1, 0, 0, 25); pTitle.Position = UDim2.new(0, 0, 1, -165); pTitle.Text = "-- SELECT TARGET (30s REFRESH) --"; pTitle.TextColor3 = Color3.fromRGB(255, 200, 0); pTitle.BackgroundTransparency = 1; pTitle.Font = Enum.Font.GothamBold; pTitle.TextSize = 10

local playerScroll = Instance.new("ScrollingFrame", main); playerScroll.Size = UDim2.new(1, -20, 0, 130); playerScroll.Position = UDim2.new(0, 10, 1, -140); playerScroll.BackgroundColor3 = Color3.fromRGB(25, 25, 30); playerScroll.CanvasSize = UDim2.new(0, 0, 5, 0); playerScroll.ScrollBarThickness = 2
Instance.new("UIListLayout", playerScroll).Padding = UDim.new(0, 2)
Instance.new("UICorner", playerScroll)

-- プレイヤーリスト更新関数（Part 2以降でも使うためグローバル化）
_G.RefreshPlayerList = function()
    for _, child in pairs(playerScroll:GetChildren()) do if child:IsA("TextButton") then child:Destroy() end end
    for _, p in pairs(game:GetService("Players"):GetPlayers()) do
        if p ~= LP then
            local pBtn = Instance.new("TextButton", playerScroll)
            pBtn.Size = UDim2.new(1, -5, 0, 30); pBtn.Text = p.DisplayName; pBtn.Font = Enum.Font.Gotham; pBtn.TextSize = 11; pBtn.TextColor3 = Color3.new(1, 1, 1)
            pBtn.BackgroundColor3 = (_G.NessiConfig.TargetPlayer == p) and Color3.fromRGB(100, 50, 150) or Color3.fromRGB(45, 45, 55)
            Instance.new("UICorner", pBtn)
            pBtn.MouseButton1Click:Connect(function()
                _G.NessiConfig.TargetPlayer = p
                _G.RefreshPlayerList()
            end)
        end
    end
end

-- トグル作成関数
_G.CreateNessiToggle = function(name, configKey)
    local btn = Instance.new("TextButton", scroll); btn.Size = UDim2.new(1, -10, 0, 35); btn.Text = name .. " : OFF"; btn.Font = Enum.Font.GothamSemibold; btn.TextSize = 12; btn.BackgroundColor3 = Color3.fromRGB(40, 40, 50); btn.TextColor3 = Color3.new(1, 1, 1)
    Instance.new("UICorner", btn)
    btn.MouseButton1Click:Connect(function()
        _G.NessiConfig[configKey] = not _G.NessiConfig[configKey]
        btn.Text = name .. (_G.NessiConfig[configKey] and " : ON" or " : OFF")
        btn.BackgroundColor3 = _G.NessiConfig[configKey] and Color3.fromRGB(0, 150, 80) or Color3.fromRGB(40, 40, 50)
    end)
end

-- UI表示切替
UIS.InputBegan:Connect(function(i, g) if not g and i.KeyCode == Enum.KeyCode.RightControl then main.Visible = not main.Visible end end)
-- [[ NESSI HUB FULL POWER : PART 2 ]]
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- メインループ開始
task.spawn(function()
    while task.wait() do
        -- 【1】 プレイヤーリストの30秒自動更新チェック
        if tick() - _G.LastRefresh > 30 then
            _G.LastRefresh = tick()
            pcall(function()
                if _G.RefreshPlayerList then
                    _G.RefreshPlayerList()
                    print("Nessi Hub: Player List Refreshed.")
                end
            end)
        end

        pcall(function()
            local char = LP.Character
            if not char or not char:FindFirstChild("HumanoidRootPart") then return end
            local root = char.HumanoidRootPart

            -- --- 【2. 攻撃系（全マップ・即死・高速）】 ---
            if _G.NessiConfig.MapAttack or _G.NessiConfig.InstantKill or _G.NessiConfig.FastAttack then
                for _, v in pairs(workspace.Enemies:GetChildren()) do
                    if v:FindFirstChild("Humanoid") and v:FindFirstChild("HumanoidRootPart") and v.Humanoid.Health > 0 then
                        -- 即死
                        if _G.NessiConfig.InstantKill then v.Humanoid.Health = 0 end
                        
                        -- 攻撃パケット送信（全マップ/高速）
                        ReplicatedStorage.Modules.Net["RE/RegisterHit"]:FireServer(v.HumanoidRootPart, {{v, v.HumanoidRootPart}})
                    end
                end
            end

            -- --- 【3. ファーム系（幽霊船・SB）】 ---
            if _G.NessiConfig.GhostShipFarm then
                for _, v in pairs(workspace:GetChildren()) do
                    if (v.Name == "ShipGroup" or v.Name == "GhostShip") and v:FindFirstChildWhichIsA("BasePart") then
                        root.CFrame = v:FindFirstChildWhichIsA("BasePart").CFrame * CFrame.new(0, 60, 0)
                    end
                end
            elseif _G.NessiConfig.SBFarm then
                for _, v in pairs(workspace:GetChildren()) do
                    if v.Name == "Sea Beast" and v:FindFirstChild("HumanoidRootPart") then
                        root.CFrame = v.HumanoidRootPart.CFrame * CFrame.new(0, 50, 0)
                    end
                end
            end

            -- --- 【4. 自動レイド】 ---
            if _G.NessiConfig.AutoRaid then
                for _, v in pairs(workspace.Enemies:GetChildren()) do
                    if v:FindFirstChild("Humanoid") and v.Humanoid.Health > 0 then
                        root.CFrame = v.HumanoidRootPart.CFrame * CFrame.new(0, 20, 0)
                        v.Humanoid.Health = 0
                    end
                end
            end

            -- --- 【5. プレイヤー追尾（Stick）】 ---
            if _G.NessiConfig.StickActive and _G.NessiConfig.TargetPlayer then
                local tChar = _G.NessiConfig.TargetPlayer.Character
                if tChar and tChar:FindFirstChild("HumanoidRootPart") then
                    root.CFrame = tChar.HumanoidRootPart.CFrame * CFrame.new(0, 0, 5)
                end
            end
        end)
    end
end)

print("Part 2: Combat & Farm Logic Loaded.")-- [[ NESSI HUB FULL POWER : PART 3 ]]
-- 移動系ロジック、ヒットボックス、およびボタンの流し込み

-- --- 【1. 空中歩行 (Air Walk) ロジック】 ---
local AirPlatform = Instance.new("Part", workspace)
AirPlatform.Name = "NessiAirWalkPlatform"
AirPlatform.Size = Vector3.new(30, 1, 30)
AirPlatform.Transparency = 1
AirPlatform.Anchored = true

game:GetService("RunService").Stepped:Connect(function()
    if _G.NessiConfig.AirWalk and LP.Character and LP.Character:FindFirstChild("HumanoidRootPart") then
        AirPlatform.CFrame = LP.Character.HumanoidRootPart.CFrame * CFrame.new(0, -3.5, 0)
        AirPlatform.CanCollide = true
    else
        AirPlatform.CanCollide = false
        AirPlatform.CFrame = CFrame.new(0, -1000, 0)
    end
end)

-- --- 【2. NPCヒットボックス拡大ロジック】 ---
task.spawn(function()
    while task.wait(0.5) do -- 負荷軽減のため0.5秒ごとにスキャン
        if _G.NessiConfig.Hitbox then
            pcall(function()
                for _, v in pairs(workspace.Enemies:GetChildren()) do
                    if v:FindFirstChild("HumanoidRootPart") then
                        v.HumanoidRootPart.Size = Vector3.new(_G.NessiConfig.HitboxSize, _G.NessiConfig.HitboxSize, _G.NessiConfig.HitboxSize)
                        v.HumanoidRootPart.Transparency = 0.8
                        v.HumanoidRootPart.CanCollide = false
                    end
                end
            end)
        end
    end
end)

-- --- 【3. ボタンをUIに登録（Part 1の関数を呼び出し）】 ---
if _G.CreateNessiToggle then
    _G.CreateNessiToggle("全マップ攻撃 (Map)", "MapAttack")
    _G.CreateNessiToggle("即死 (HP 0)", "InstantKill")
    _G.CreateNessiToggle("高速クリック攻撃", "FastAttack")
    _G.CreateNessiToggle("幽霊船素材集め", "GhostShipFarm")
    _G.CreateNessiToggle("シービースト狩り", "SBFarm")
    _G.CreateNessiToggle("自動レイドクリア", "AutoRaid")
    _G.CreateNessiToggle("NPCヒットボックス拡大", "Hitbox")
    _G.CreateNessiToggle("空中歩行 (Air Walk)", "AirWalk")
    _G.CreateNessiToggle("【！】プレイヤー追尾", "StickActive")
end

-- 初回のリスト更新をキック
if _G.RefreshPlayerList then
    _G.RefreshPlayerList()
end

print("================================")
print("NESSI HUB FULL POWER: COMPLETED!")
print("Enjoy your ultimate farm, Buddy!")
print("================================")
print("Part 1: UI Foundation Loaded.")
