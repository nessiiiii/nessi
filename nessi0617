-- [[ NESSI HUB v6.2 : STABLE FULL VERSION ]]
local LP = game:GetService("Players").LocalPlayer
local UIS = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local VU = game:GetService("VirtualUser")
local Cam = workspace.CurrentCamera

-- 重複起動防止
if LP.PlayerGui:FindFirstChild("NessiHub_Official") then LP.PlayerGui.NessiHub_Official:Destroy() end

-- 設定（ここに全てのフラグを集中）
getgenv().Config = {
    FastAttack = false,
    InstantKill = false,
    MapAttack = false,
    GhostShipFarm = false,
    SBFarm = false,
    Hitbox = false,
    HitboxSize = 30,
    AirWalk = false,
    SpeedHack = false
}

-- --- 【UI構築：シンプル・イズ・ベスト】 ---
local sg = Instance.new("ScreenGui", LP.PlayerGui); sg.Name = "NessiHub_Official"; sg.ResetOnSpawn = false
local main = Instance.new("Frame", sg); main.Size = UDim2.new(0, 450, 0, 500); main.Position = UDim2.new(0.5, -225, 0.5, -250); main.BackgroundColor3 = Color3.fromRGB(15, 15, 15); main.Active = true; main.Draggable = true
Instance.new("UICorner", main).CornerRadius = UDim.new(0, 10)

local title = Instance.new("TextLabel", main); title.Size = UDim2.new(1, 0, 0, 40); title.Text = "NESSI HUB v6.2 (STABLE)"; title.TextColor3 = Color3.new(1,1,1); title.BackgroundTransparency = 1; title.Font = Enum.Font.GothamBold

-- スクロールエリア（ここに全部並べる）
local scroll = Instance.new("ScrollingFrame", main); scroll.Size = UDim2.new(1, -20, 1, -60); scroll.Position = UDim2.new(0, 10, 0, 50); scroll.BackgroundTransparency = 1; scroll.CanvasSize = UDim2.new(0,0,2,0); scroll.ScrollBarThickness = 3
local layout = Instance.new("UIListLayout", scroll); layout.Padding = UDim.new(0, 5)

-- --- 【ボタン作成関数】 ---
local function AddToggle(n, k)
    local b = Instance.new("TextButton", scroll); b.Size = UDim2.new(1, -10, 0, 40); b.Text = n .. ": OFF"; b.BackgroundColor3 = Color3.fromRGB(30, 30, 30); b.TextColor3 = Color3.new(1, 1, 1); b.Font = Enum.Font.Gotham
    Instance.new("UICorner", b)
    b.MouseButton1Click:Connect(function()
        getgenv().Config[k] = not getgenv().Config[k]
        b.Text = n .. (getgenv().Config[k] and ": ON" or ": OFF")
        b.BackgroundColor3 = getgenv().Config[k] and Color3.fromRGB(50, 80, 50) or Color3.fromRGB(30, 30, 30)
    end)
end

-- --- 【機能一覧】 ---
AddToggle("【強】全マップ攻撃 (Map Attack)", "MapAttack")
AddToggle("【新】幽霊船素材集め", "GhostShipFarm")
AddToggle("【新】シービースト狩り", "SBFarm")
AddToggle("高速攻撃 (Fast Attack)", "FastAttack")
AddToggle("即死命令 (Instant Kill)", "InstantKill")
AddToggle("NPCヒットボックス拡大", "Hitbox")
AddToggle("空中歩行 (Air Walk)", "AirWalk")
AddToggle("足加速 (Speed Hack)", "SpeedHack")

-- --- 【コアロジック：ひとつのループで全部回す】 ---
task.spawn(function()
    while true do RunService.Heartbeat:Wait()
        pcall(function()
            local char = LP.Character; if not char then return end
            local root = char.HumanoidRootPart

            -- 1. 攻撃系 (MapAttack / FastAttack / InstantKill)
            for _, v in pairs(workspace.Enemies:GetChildren()) do
                if v:FindFirstChild("HumanoidRootPart") and v:FindFirstChild("Humanoid") and v.Humanoid.Health > 0 then
                    if getgenv().Config.MapAttack or getgenv().Config.FastAttack then
                        game:GetService("ReplicatedStorage").Modules.Net["RE/RegisterHit"]:FireServer(v.HumanoidRootPart, {{v, v.Head}})
                    end
                    if getgenv().Config.InstantKill then
                        v.Humanoid.Health = 0
                    end
                end
            end

            -- 2. ヒットボックス (NPCのみ)
            for _, v in pairs(workspace.Enemies:GetChildren()) do
                if v:FindFirstChild("HumanoidRootPart") then
                    v.HumanoidRootPart.Size = getgenv().Config.Hitbox and Vector3.new(30, 30, 30) or Vector3.new(2, 2, 1)
                    v.HumanoidRootPart.Transparency = getgenv().Config.Hitbox and 0.8 or 0
                    v.HumanoidRootPart.CanCollide = false
                end
            end

            -- 3. 幽霊船 & SB テレぽ
            if getgenv().Config.GhostShipFarm then
                for _, v in pairs(workspace:GetChildren()) do
                    if (v.Name == "ShipGroup" or v.Name == "GhostShip") and v:FindFirstChildWhichIsA("BasePart") then
                        root.CFrame = v:FindFirstChildWhichIsA("BasePart").CFrame * CFrame.new(0, 50, 0)
                    end
                end
            elseif getgenv().Config.SBFarm then
                for _, v in pairs(workspace:GetChildren()) do
                    if v.Name == "Sea Beast" and v:FindFirstChild("HumanoidRootPart") then
                        root.CFrame = v.HumanoidRootPart.CFrame * CFrame.new(0, 50, 0)
                    end
                end
            end
        end)
    end
end)

-- 空中歩行
local aw = Instance.new("Part", workspace); aw.Size = Vector3.new(20,1,20); aw.Anchored = true; aw.Transparency = 1
RunService.Heartbeat:Connect(function()
    if getgenv().Config.AirWalk and LP.Character:FindFirstChild("HumanoidRootPart") then
        aw.CFrame = LP.Character.HumanoidRootPart.CFrame * CFrame.new(0,-3.5,0); aw.CanCollide = true
    else aw.CanCollide = false end
end)

-- 右コン非表示
UIS.InputBegan:Connect(function(i, g) if not g and i.KeyCode == Enum.KeyCode.RightControl then main.Visible = not main.Visible end end)
