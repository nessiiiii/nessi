-- [[ NESSI HUB v6.0 : MAP ATTACK & NPC HITBOX ONLY ]]
local LP = game:GetService("Players").LocalPlayer
local UIS = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local Cam = workspace.CurrentCamera
local VU = game:GetService("VirtualUser")

-- 重複起動防止
if LP.PlayerGui:FindFirstChild("NessiHub_Official") then LP.PlayerGui.NessiHub_Official:Destroy() end

getgenv().Config = {
    FastAttack = false, InstantKill = false, 
    MapAttack = false, -- ★全マップ攻撃
    AttackRange = 5000, -- 範囲を大幅に拡大
    Hitbox = false, HitboxSize = 30,
    GhostShipFarm = false, SBFarm = false, AutoRaid = false,
    AirWalk = false, Fly = false, SpeedHack = false,
    EspLine = false, StickActive = false, StickTargetPlayer = nil
}

-- --- 【UI構築 (MODメニュー形式)】 ---
local sg = Instance.new("ScreenGui", LP.PlayerGui); sg.Name = "NessiHub_Official"; sg.ResetOnSpawn = false
local main = Instance.new("Frame", sg); main.Size = UDim2.new(0, 600, 0, 400); main.Position = UDim2.new(0.5, -300, 0.5, -200); main.BackgroundColor3 = Color3.fromRGB(20, 20, 20); main.Active = true; main.Draggable = true
Instance.new("UICorner", main).CornerRadius = UDim.new(0, 12)

local sidebar = Instance.new("Frame", main); sidebar.Size = UDim2.new(0, 150, 1, -40); sidebar.Position = UDim2.new(0, 10, 0, 30); sidebar.BackgroundTransparency = 1
Instance.new("UIListLayout", sidebar).Padding = UDim.new(0, 5)

local container = Instance.new("Frame", main); container.Size = UDim2.new(1, -180, 1, -40); container.Position = UDim2.new(0, 170, 0, 30); container.BackgroundTransparency = 1

local tabs = {}
local function CreateTab(name)
    local t = Instance.new("ScrollingFrame", container); t.Size = UDim2.new(1, 0, 1, 0); t.BackgroundTransparency = 1; t.Visible = false; t.CanvasSize = UDim2.new(0,0,2,0)
    Instance.new("UIListLayout", t).Padding = UDim.new(0, 5)
    tabs[name] = t
    local btn = Instance.new("TextButton", sidebar); btn.Size = UDim2.new(1, 0, 0, 35); btn.Text = name; btn.BackgroundColor3 = Color3.fromRGB(35, 35, 35); btn.TextColor3 = Color3.new(1,1,1)
    Instance.new("UICorner", btn)
    btn.MouseButton1Click:Connect(function() for _, tab in pairs(tabs) do tab.Visible = false end t.Visible = true end)
    return t
end

local mainTab = CreateTab("MAIN")
local farmTab = CreateTab("FARM")
local moveTab = CreateTab("MOVE")
local visualTab = CreateTab("VISUAL")
mainTab.Visible = true

-- --- 【強化ロジック：全マップ攻撃 & NPC限定ヒットボックス】 ---
task.spawn(function()
    while true do RunService.Heartbeat:Wait()
        pcall(function()
            local char = LP.Character; if not char then return end
            
            -- 【1】全マップ攻撃 (Map Attack)
            if getgenv().Config.MapAttack then
                for _, v in pairs(workspace.Enemies:GetChildren()) do
                    if v:FindFirstChild("HumanoidRootPart") and v:FindFirstChild("Humanoid") and v.Humanoid.Health > 0 then
                        -- 距離に関係なくRegisterHitを飛ばす
                        game:GetService("ReplicatedStorage").Modules.Net["RE/RegisterHit"]:FireServer(v.HumanoidRootPart, {{v, v.Head}})
                    end
                end
            end

            -- 【2】NPC限定ヒットボックス (NPC Only)
            for _, v in pairs(workspace.Enemies:GetChildren()) do
                if v:FindFirstChild("HumanoidRootPart") then
                    if getgenv().Config.Hitbox then
                        v.HumanoidRootPart.Size = Vector3.new(getgenv().Config.HitboxSize, getgenv().Config.HitboxSize, getgenv().Config.HitboxSize)
                        v.HumanoidRootPart.Transparency = 0.7
                        v.HumanoidRootPart.CanCollide = false
                    else
                        v.HumanoidRootPart.Size = Vector3.new(2, 2, 1) -- 元のサイズ
                        v.HumanoidRootPart.Transparency = 0
                    end
                end
            end
            -- ※プレイヤー(Players)への処理を入れないことで、プレイヤーにはつかない。
        end)
    end
end)

-- --- 【UIトグル追加】 ---
local function AddToggle(parent, n, k)
    local b = Instance.new("TextButton", parent); b.Size = UDim2.new(1, -10, 0, 35); b.Text = n .. ": OFF"; b.BackgroundColor3 = Color3.fromRGB(40,40,40); b.TextColor3 = Color3.new(1,1,1); Instance.new("UICorner", b)
    b.MouseButton1Click:Connect(function() getgenv().Config[k] = not getgenv().Config[k] b.Text = n .. (getgenv().Config[k] and ": ON" or ": OFF") b.TextColor3 = getgenv().Config[k] and Color3.new(0,1,0) or Color3.new(1,1,1) end)
end

-- MAIN項目
AddToggle(mainTab, "全マップ攻撃 (Map Attack)", "MapAttack")
AddToggle(mainTab, "高速攻撃 (Fast Attack)", "FastAttack")
AddToggle(mainTab, "即死命令 (Instant Kill)", "InstantKill")

-- FARM項目
AddToggle(farmTab, "幽霊船ファーム", "GhostShipFarm")
AddToggle(farmTab, "シービーストファーム", "SBFarm")

-- VISUAL項目
AddToggle(visualTab, "NPCヒットボックス拡大", "Hitbox")
AddToggle(visualTab, "線ESP", "EspLine")

-- その他
UIS.InputBegan:Connect(function(i, g) if not g and i.KeyCode == Enum.KeyCode.RightControl then main.Visible = not main.Visible end end)
